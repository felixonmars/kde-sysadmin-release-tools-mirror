version=3.0-alpha1
package=$1

CDPATH=""

test -n "$package" || { echo "requires modulename as parameter"; exit 1; }
test -d clean || { echo "create clean subdir with cvs checkout"; exit 1; }
test -d dirty || { echo "create empty subdir dirty"; exit 1; }
test -d sources || { echo "create empty subdir sources"; exit 1; }

test -d clean/$package || { echo "sorry, clean/$package does not exist"; exit 1; }
echo "rm -rf dirty/$package-$version"
rm -rf dirty/$package-$version
echo "rm -rf dirty/$package"
rm -rf dirty/$package

echo "cp -pr clean/$package/ dirty"
cp -pr clean/$package dirty || exit 1
(
  echo "cd dirty"
  cd dirty || exit 1
  echo "anon $package"
  ../anon $package || exit 1
 echo "docu $package"
 ../docu $package || exit 1
  echo "dist $package"
  ../dist $package $version || exit 1
  echo "mv $package $package-$version"
  mv $package $package-$version || exit 1
  echo "tar cjf $package-$version.tar.bz2 $package-$version"
  tar --owner=root --group=root -cjf ../sources/$package-$version.tar.bz2 $package-$version || exit 1
)
