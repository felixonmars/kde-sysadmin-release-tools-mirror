(
  CDPATH=""
  export UNSERMAKE=no
  package=$1
  version=$2
  export version
  cd $package

  isl10n=0
  case $package in
    *-l10n)
      isl10n=1
      ;;
  esac

  if [ $package = "qt-copy" ] || [ $package = "kdoc" ]; then
    make -f Makefile.cvs || exit 1
  elif test $isl10n -eq 1; then
    cat subdirs | while read lang; do
      scripts/autogen.sh $lang
    done
  else
    make -f admin/Makefile.common dist || exit 1
  fi

  # remove junk
  find . -maxdepth 3 -type d -name autom4te.cache | xargs rm -rf

) || exit 1
